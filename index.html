<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Table</title>
    <!-- Подключение библиотеки WaveSurfer.js -->
    <!-- <link rel="stylesheet" href="https://unpkg.com/wavesurfer.js/dist/wavesurfer.min.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://unpkg.com/wavesurfer.js"></script>
    
</head>
<body>

<!-- Место для вставки таблицы и аудиоплеера -->
<div id="audioTableContainer"></div>


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    // Функция для создания и настройки wavesurfer
    function createWaveSurfer(containerId, audioUrl) {
        var wavesurfer = WaveSurfer.create({
            container: "#" + containerId,
            waveColor: "#E7D1D3",
            progressColor: "#1e594f",
            height: 45,
            responsive: true,
            hideScrollbar: true,
            cursorColor: "#E7D1D3",
            cursorWidth: 2,
            barWidth: 5,
            barGap: 1.5,
            skipLength: 5
        });

        wavesurfer.load(audioUrl);

        $("#" + containerId).on("click", function() {
            console.log("clicked в поля");
            wavesurfer.playPause();
        });

        return wavesurfer;
    }

    // Функция для создания HTML-таблицы
    function createAudioTable(data) {
        var tableHtml = '<table class="table table-bordered table-dark"><thead><tr><th>ID</th><th>Name</th><th>Audio</th></tr></thead><tbody>';
        
        data.forEach(function(item) {
            var containerId = "audioContainer_" + item.id;
            

            // Добавление строки в таблицу
            tableHtml += '<tr>';
            tableHtml += '<td>' + item.id + '</td>';
            tableHtml += '<td>' + item.name + '</td>';
            tableHtml += '<td><div id="' + containerId + '"></div></td>';
            tableHtml += '</tr>';

        });

        tableHtml += '</tbody></table>';
        
        // Вставка таблицы в документ
        $("#audioTableContainer").html(tableHtml);
        
        data.forEach(item => {
            var containerId = "audioContainer_" + item.id;
            item.audio = 'audioContainer_'+item.id+'.mpeg';
            
            // Создание wavesurfer для текущего аудиофайла
            console.log('item.audio', item.audio);
            createWaveSurfer(containerId, item.audio);
        })
    }

    // AJAX-запрос к серверу для получения данных
    $.ajax({
        url: "https://jsonplaceholder.typicode.com/users",
        success: function(data) {
            
            let users = data.slice(0, 3)
            console.log('users', users); 

            // При успешном получении данных
            createAudioTable(users);
        },
        error: function(err) {
            console.error('err', err);
        }
    });
</script>

</body>
</html>
